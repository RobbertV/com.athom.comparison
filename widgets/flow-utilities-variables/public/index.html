<html>
  <head>
    <link rel="stylesheet" crossorigin href="./index.css">
  </head>

  <body class="homey-widget">
    <table class="homey-table homey-text-align-left">
      <!-- <thead>
                        <tr>
                          <th data-i18n="settings.variables"></th>
                          <th data-i18n="settings.loading"></th>
                        </tr>
                      </thead> -->
      <tbody></tbody>
    </table>
    <script>
      function onHomeyReady(Homey) {
        console.log('Widget settings:', Homey.getSettings());
        init(Homey);
      }

      function getAppSetting(appSettings, key) {
        return appSettings[key];
      }

      function init(Homey) {
        const widgetSettings = Homey.getSettings();

        Homey.api("GET", "/").then((response) => {
          const appSettings = response;
          const data = getAppSetting(appSettings, "TOTALS");

          // render table  in tbody based on data
          const tbody = document.querySelector('tbody')
          tbody.innerHTML = ''

          for (const row of data) {
            const tr = document.createElement('tr')
            tbody.appendChild(tr)

            const td = document.createElement('td')
            td.innerHTML = `<p class="homey-text-bold">${row.token}</p>`
            // tr.appendChild(tdName)

            // const tdValue = document.createElement('td')
            for (k in row) {
              if (k !== 'token') {
                td.innerHTML += `
                <div class="homey-text-small-light container">
                  <div>${Homey.__(`helpers.${k}`)}: </div> <div class="text-left">${row[k]}</div>
                </div>`;
              }
            }
            tr.appendChild(td)
          }

          Homey.ready({ height: 580 });
        }).catch((error) => {
          console.error(error);
        });
      }
    </script>
  </body>
</html>